# HTTP API를 만들어보자

## URI 설계

> 리소스를 기준으로 설계를 하자.

- 회원 목록 조회
- 회원 조회
- 회원 등록
...

설계를 해보자.

- /members
- /members/{id}
- /members/{id}
- /members/{id}
- /members/{id}

어떻게 구분하냐?
요기서 HTTP 메서드를 활용하면 된다.

리소스와 행위를 분리하자.
URI는 리소스만 식별하자!
URI는 행위에 대한 정보는 담겨있으면 안된다.

# HTTP 메서드 - GET, POST

자주 사용하는 메서드들

- GET: 리소스 조회
- POST: 요청 데이터 처리, 주로 등록
- PUT: 리소스를 대체, 해당 리소스가 없으면 생성
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제

기타 메서드

- HEAD: 헤더만 줘
- OPTIONS: CORS에서 사용
- CONNECT, TRACE는 거의 사용하지 않음

### GET

> 리소스 조회

- 서버에 전달하고 싶은 데이터는 쿼리를 통해서 전달
- 실무에서는 보통 바디에 데이터를 담는 것을 권장하진 않는다.

### POST

> 요청 데이터 처리

- 메세지 바디를 통해 서버로 요청 데이터 전달
- HTML form 입력 된 필드와 같은 데이터 블록 처리 프로세스에 사용
- 게시판 글쓰기, 댓글 쓰기와 같은 곳에 사용된다.
- 신규 회원, 신규 주문같은 새로운 리소스 생성
- 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 결정해야 함

주로 사용되는 곳?

1. 새 리소스 등록
2. 요청 데이터 처리

post는 사실 모든 것을 할 수 있다. 조회할 때는 GET이 유리하다. (캐싱이나 서버에서의 작업들이 있음)

# HTTP 메서드 - PUT, PATCH, DELETE

### PUT

> 리소스를 완전히! 대체

기존에 있으면 덮음, 없으면 생성

중요한 것은 클라이언트가 리소스를 식별한다. 리소스의 위치를 알고 URI를 지정한다.

example: PUT member/100

주의해야 하는건 기존 리소스를 완전히 대체하기 떄문에 조심해야 한다.

### PATCH

> 리소스 부분 변경

### DELETE

> 리소스 제거

# HTTP 메서드 속성

### 안전

> 호출해도 리소스를 변경하지 않는다.

- GET, HEAD, OPTIONS, TRACES은 안전하다.
- POST, DELETE, PUT 같은 것은 안전하지 않다.

해당 리소스가 변하냐 안 변하냐 이런 것만 고려한다.

### 멱등 (Idempotent)

> 한 번 호출하든 100번 호출하든 결과가 똑같다.

- GET: 같은 결과가 조회된다.
- PUT: 결과를 대체한다. 결과물만 보면 결과는 똑같다.
- DELETE: 삭제도 똑같은 결과다.
- POST: POST는 멱등하지 않다. 같은 결과가 아니다. (결제 같은게 두 번 일어나면 안됨)

어디서 활용할까?

- 자동 복구 매커니즘에 사용된다. 왜냐하면 여러 번 호출해도 같은 결과를 낳으니까 실패했을 때 다시 호출해도 괜찮다. 멱등하지 않으면 다시 호출하지 말자.

멱등은 외부 요인으로 중간에 리소스가 변하는 것 까지는 고려하지 않는다. 

### 캐시 가능 (Cacheable)

> 응답 결과 리소스를 캐시해서 사용해도 되는가?

- GET, HEAD, POST, PATCH를 캐시 가능하다.
- 실제로는 GET, HEAD 정도만 캐시한다.
- POST, PATCH는 본문 내용까지 캐시 키로 고려해야 해서 구현이 쉽지 않다.
